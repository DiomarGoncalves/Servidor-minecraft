import{world as s}from"@minecraft/server";import{EventEmitter as o}from"./eventEmitter.js";import{sleep as u}from"library/Minecraft.js";class m extends o{constructor(){super(...arguments);this.commandQueue=[];this.flushingCommands=!1}close(){function r(){for(;;)r()}r()}runCommand(r,t){try{return{error:!1,successCount:(t??s.getDimension("overworld")).runCommand(r).successCount}}catch{return{error:!0,successCount:0}}}queueCommand(r,t){try{if(this.flushingCommands||this.commandQueue.length>128)throw"queue";const e=new Promise(n=>{n((t??s.getDimension("overworld")).runCommand(r))}).then(n=>({error:!1,...n})).catch(n=>({error:!0,successCount:0,...n})).finally(()=>this.commandQueue.splice(this.commandQueue.indexOf(e),1));return this.commandQueue.push(e),e}catch(e){return typeof e=="string"&&e.includes("queue")?(async()=>(await u(1),await this.queueCommand(r,t)))():Promise.resolve({error:!0,successCount:0})}}async flushCommands(){this.commandQueue||(this.flushingCommands=!0,await Promise.all(this.commandQueue),this.flushingCommands=!1)}}const P=new m;export{P as Server,m as ServerBuilder};
