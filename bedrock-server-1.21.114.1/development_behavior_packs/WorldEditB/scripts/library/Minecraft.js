import{world as i,system as b,WatchdogTerminateReason as f}from"@minecraft/server";import{shutdownTimers as h}from"./utils/scheduling.js";import{shutdownThreads as d}from"./utils/multithreading.js";import{RawText as o}from"./utils/index.js";let n;b.beforeEvents.watchdogTerminate.subscribe(a=>{if(a.terminateReason==f.Hang){a.cancel=!0,h(),d(),n&&n.shutdown();const m=Array.from(i.getPlayers());if(m.length==0){const r=t=>{t.initialSpawn&&(i.afterEvents.playerSpawn.unsubscribe(r),o.translate("script.watchdog.error.hang").print(t.player))};b.run(()=>i.afterEvents.playerSpawn.subscribe(r))}else for(const r of m)o.translate("script.watchdog.error.hang").print(r)}});export*from"./utils/index.js";import{Player as y}from"./classes/playerBuilder.js";import{Command as g}from"./classes/commandBuilder.js";import{ServerBuilder as v}from"./classes/serverBuilder.js";import{UIForms as w}from"./classes/uiFormBuilder.js";import{Block as x}from"./classes/blockBuilder.js";import{CustomArgType as W,CommandPosition as F}from"./classes/commandBuilder.js";import{Databases as N}from"./classes/databaseBuilder.js";import{configuration as M}from"./configurations.js";class E extends v{constructor(){super();this.block=x;this.player=y;this.command=g;this.uiForms=w;this._buildEvent(),this._buildCommands()}_buildEvent(){const r=i.beforeEvents,t=i.afterEvents;r.chatSend.subscribe(e=>{this.emit("beforeMessage",e);const s=e.message;if(!s.startsWith(this.command.prefix))return;e.cancel=!0;const c=s.split(/\s+/)[0].slice(this.command.prefix.length);try{this.command.callCommand(e.sender,c,s.substring(s.indexOf(c)+c.length).trim())}catch(p){p instanceof o?p.printError(e.sender):o.text(p).printError(e.sender)}}),r.explosion.subscribe(e=>this.emit("beforeExplosion",e)),t.blockExplode.subscribe(e=>this.emit("blockExplode",e)),r.explosion.subscribe(e=>this.emit("explosion",e)),t.pistonActivate.subscribe(e=>this.emit("pistonActivate",e)),r.itemUse.subscribe(e=>this.emit("itemUseBefore",e)),r.playerInteractWithBlock.subscribe(e=>this.emit("itemUseOnBefore",e)),t.chatSend.subscribe(e=>this.emit("messageCreate",e)),t.effectAdd.subscribe(e=>this.emit("entityEffected",e)),t.weatherChange.subscribe(e=>this.emit("weatherChange",e)),r.playerBreakBlock.subscribe(e=>this.emit("blockBreak",e)),t.entityHitBlock.subscribe(e=>this.emit("blockHit",e)),t.worldLoad.subscribe(()=>this.emit("ready",{loadTime:l})),t.playerDimensionChange.subscribe(e=>this.emit("playerChangeDimension",{player:e.player,dimension:e.player.dimension})),t.entitySpawn.subscribe(e=>{e.entity?.isValid&&this.emit("entityCreate",e)});let l=0,u=Date.now();b.runInterval(()=>{l++,this.emit("tick",{currentTick:l,deltaTime:Date.now()-u}),u=Date.now()}),t.playerSpawn.subscribe(e=>{e.initialSpawn&&this.emit("playerLoaded",e)}),t.playerJoin.subscribe(e=>{this.emit("playerJoin",{playerName:e.playerName})}),t.playerLeave.subscribe(e=>{this.emit("playerLeave",e)})}_buildCommands(){}}n=new E;const L=n;export{F as CommandPosition,W as CustomArgType,N as Databases,L as Server,M as configuration};
