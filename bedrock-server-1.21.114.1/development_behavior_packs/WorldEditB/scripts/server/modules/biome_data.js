import{world as p}from"@minecraft/server";import{contentLog as f,Databases as g,Vector as u}from"library/Minecraft.js";import{locToString as b,wrap as l}from"../util.js";class m{constructor(e=""){this.id=-1;this.name="unknown";if(!(Number.parseInt(e)<0)&&e){const s=m.parseArgs([e]).result;this.id=s.id,this.name=s.name}}getId(){return this.id}getName(){return this.name}clone(){const e=new m;return e.id=this.id,e.name=this.name,e}toString(){return`[biome: ${this.name}/${this.id}]`}static parseArgs(e,s=0){const t=e[s],a=new m;if(!t)return{result:a,argIndex:s+1};if(t in _)a.name=t,a.id=_[t];else if(Number.parseInt(t)in h){const n=Number.parseInt(t);a.id=n,a.name=h[n]}else throw{isSyntaxError:!0,stack:f.stack(),idx:s};return{result:a,argIndex:s+1}}}class w{constructor(e){this.dimension=e;this.changes=new Map}setBiome(e,s){const t=b(new u(Math.floor(e.x/16),Math.floor(e.y/16),Math.floor(e.z/16)));this.changes.has(t)||this.changes.set(t,new Map);const a=this.changes.get(t);a.set(this.locToId(new u(l(e.x,16),l(e.y,16),l(e.z,16))),s),a.size==4096&&this.flush()}flush(){for(const[e,s]of this.changes){const t=`biome,${this.dimension.id},${e}`,a=g.load(t,p,!0);let n=[];if(!("biomes"in a))n.length=4096,n=n.fill(-1);else{const r=a.data.palette;n=a.data.biomes.map(i=>i?r[i-1]:-1)}for(const[r,i]of s.entries())n[r]=i;const o=new Map;for(const r of n)r>=0&&o.set(r,null);const d=Array.from(o.keys());o.clear(),d.forEach((r,i)=>o.set(r,i+1)),o.set(-1,0),a.data.biomes=n.map(r=>o.get(r)),a.data.palette=d,a.save()}this.changes.clear()}locToId(e){return e.x+e.y*16+e.z*256}}const _={ocean:0,plains:1,desert:2,extreme_hills:3,forest:4,taiga:5,swampland:6,river:7,hell:8,the_end:9,legacy_frozen_ocean:10,frozen_river:11,ice_plains:12,ice_mountains:13,mushroom_island:14,mushroom_island_shore:15,beach:16,desert_hills:17,forest_hills:18,taiga_hills:19,extreme_hills_edge:20,jungle:21,jungle_hills:22,jungle_edge:23,deep_ocean:24,stone_beach:25,cold_beach:26,birch_forest:27,birch_forest_hills:28,roofed_forest:29,cold_taiga:30,cold_taiga_hills:31,mega_taiga:32,mega_taiga_hills:33,extreme_hills_plus_trees:34,savanna:35,savanna_plateau:36,mesa:37,mesa_plateau_stone:38,mesa_plateau:39,warm_ocean:40,deep_warm_ocean:41,lukewarm_ocean:42,deep_lukewarm_ocean:43,cold_ocean:44,deep_cold_ocean:45,frozen_ocean:46,deep_frozen_ocean:47,bamboo_jungle:48,bamboo_jungle_hills:49,sunflower_plains:129,desert_mutated:130,extreme_hills_mutated:131,flower_forest:132,taiga_mutated:133,swampland_mutated:134,ice_plains_spikes:140,jungle_mutated:149,jungle_edge_mutated:151,birch_forest_mutated:155,birch_forest_hills_mutated:156,roofed_forest_mutated:157,cold_taiga_mutated:158,redwood_taiga_mutated:160,redwood_taiga_hills_mutated:161,extreme_hills_plus_trees_mutated:162,savanna_mutated:163,savanna_plateau_mutated:164,mesa_bryce:165,mesa_plateau_stone_mutated:166,mesa_plateau_mutated:167,soulsand_valley:178,crimson_forest:179,warped_forest:180,basalt_deltas:181,jagged_peaks:182,frozen_peaks:183,snowy_slopes:184,grove:185,meadow:186,lush_caves:187,dripstone_caves:188,stony_peaks:189,deep_dark:190,mangrove_swamp:191,cherry_grove:192},h=Object.fromEntries(Object.entries(_).map(([c,e])=>[e,c]));export{m as Biome,w as BiomeChanges};
