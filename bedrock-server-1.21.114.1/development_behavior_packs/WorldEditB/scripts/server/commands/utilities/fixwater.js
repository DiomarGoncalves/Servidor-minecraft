import{Jobs as r}from"server/modules/jobs.js";import{RawText as y}from"library/Minecraft.js";import{registerCommand as w}from"../register_commands.js";import{fluidLookPositions as p}from"./drain.js";import{floodFill as g}from"./floodfill_func.js";const k={name:"fixwater",permission:"worldedit.utility.fixwater",description:"commands.wedit:fixwater.description",usage:[{name:"radius",type:"float"}]};w(k,function*(n,l,d){const s=l.dimension,m=n.getPlacementPosition();let c;for(const t of p){const o=m.offset(t.x,t.y,t.z);if(s.getBlock(o).typeId.match("water")){c=o;break}}if(!c)throw"commands.wedit:fixWater.noWater";const f=yield*r.run(n,1,function*(){yield r.nextStep("Calculating and Fixing water..."),yield r.setProgress(-1);const t=yield*g(c,d.get("radius"),e=>!!e.nextBlock.typeId.match("water"));if(!t.size)return t;const o=n.history,i=o.record();try{yield*o.trackRegion(i,t);let e=0;for(const a of t)s.getBlock(a)??(yield*r.loadBlock(a)).setType("water"),yield r.setProgress(e++/t.size);yield*o.commit(i)}catch(e){throw o.cancel(i),e}return t});return y.translate("commands.blocks.wedit:changed").with(`${f.size}`)});
