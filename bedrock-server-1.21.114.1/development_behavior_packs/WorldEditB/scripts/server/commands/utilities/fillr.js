import{Cardinal as s}from"server/modules/directions.js";import{Jobs as r}from"server/modules/jobs.js";import{RawText as k,regionBounds as w}from"library/Minecraft.js";import{registerCommand as C}from"../register_commands.js";import{floodFill as D}from"./floodfill_func.js";const P={name:"fillr",permission:"worldedit.utility.fillr",description:"commands.wedit:fillr.description",usage:[{name:"pattern",type:"Pattern"},{name:"radius",type:"float"},{name:"depth",type:"int",range:[1,null],default:-1},{name:"direction",type:"Direction",default:new s(s.Dir.DOWN)}]};C(P,function*(i,d,o){const m=d.dimension,c=o.get("direction").getDirection(d),f=o.get(o.get("depth")==-1?"radius":"depth"),p=i.getPlacementPosition(),u=yield*r.run(i,1,function*(){yield r.nextStep("Calculating and Generating blocks..."),yield r.setProgress(-1);const t=yield*D(p,o.get("radius"),(e,n)=>!(c.dot(n)<0||c.dot(e.pos.add(n))>f-1||!e.nextBlock.isAir));if(!t.size)return t;const[y,g]=w(t),h=o.get("pattern").withContext(i,[y,g]),l=i.history,a=l.record();try{yield*l.trackRegion(a,t);let e=0;for(const n of t)h.setBlock(m.getBlock(n)??(yield*r.loadBlock(n))),yield r.setProgress(e++/t.size);yield*l.commit(a)}catch(e){throw l.cancel(a),e}return t});return k.translate("commands.blocks.wedit:changed").with(`${u.size}`)});
