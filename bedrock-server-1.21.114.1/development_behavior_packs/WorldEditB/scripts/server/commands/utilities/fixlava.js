import{Jobs as i}from"server/modules/jobs.js";import{RawText as y}from"library/Minecraft.js";import{registerCommand as p}from"../register_commands.js";import{fluidLookPositions as g}from"./drain.js";import{floodFill as k}from"./floodfill_func.js";const u={name:"fixlava",permission:"worldedit.utility.fixlava",description:"commands.wedit:fixlava.description",usage:[{name:"radius",type:"float"}]};p(u,function*(a,s,d){const c=s.dimension,m=a.getPlacementPosition();let n;for(const o of g){const t=m.offset(o.x,o.y,o.z);if(c.getBlock(t).typeId.match("lava")){n=t;break}}if(!n)throw"commands.wedit:fixlava.noLava";const f=yield*i.run(a,1,function*(){yield i.nextStep("Calculating and Fixing lava..."),yield i.setProgress(-1);const o=yield*k(n,d.get("radius"),e=>!!e.nextBlock.typeId.match("lava"));if(!o.size)return o;const t=a.history,r=t.record();try{yield*t.trackRegion(r,o);let e=0;for(const l of o)c.getBlock(l)??(yield*i.loadBlock(l)).setType("lava"),yield i.setProgress(e++/o.size);yield*t.commit(r)}catch(e){throw t.cancel(r),e}return o});return y.translate("commands.blocks.wedit:changed").with(`${f.size}`)});
