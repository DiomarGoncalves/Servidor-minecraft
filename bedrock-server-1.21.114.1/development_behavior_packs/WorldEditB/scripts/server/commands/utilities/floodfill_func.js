import{Vector as o,VectorSet as x}from"library/Minecraft.js";import{Jobs as a}from"server/modules/jobs.js";const p=[new o(-1,0,0),new o(1,0,0),new o(0,-1,0),new o(0,1,0),new o(0,0,-1),new o(0,0,1)];function w(e){return`${e.x>>4},${e.z>>4}`}function g(e){const[c,s]=e.split(",").map(Number);return{x:c,z:s}}function y(e,c){return(e.x-c.x)**2+(e.z-c.z)**2}function B(e,c){let s,d=1/0;for(const[h,r]of e.entries()){const i=g(h),f=y(i,c);f<d&&(d=f,s=[h,r])}return s}function*E(e,c,s){const d={pos:o.ZERO,worldPos:o.from(e),nextBlock:yield*a.loadBlock(e)};if(!s({...d},o.ZERO))return new x;const h=a.getRunner().dimension,r=new Map,i=[[o.from(e),d]],f=new x;let k=w(e);function m(l,V,n){const t=l.offset(V.x,V.y,V.z);n.pos=t.offset(-e.x,-e.y,-e.z),n.worldPos=t;const u=w(t);u!==k?(r.has(u)||r.set(u,[]),r.get(u).push([t,n])):i.push([t,n])}for(;i.length;){const[l,V]=i.shift();if(!f.has(l)&&o.sub(l,e).length<=c+.5){f.add(l);for(const n of p){const t=o.add(l,n),u={...V,nextBlock:h.getBlock(t)??(yield*a.loadBlock(t))};try{s(u,n)&&m(l,n,u)}catch{}}}if(yield,!i.length&&r.size){const[n,t]=B(r,g(k));if(!t)continue;k=n,i.push(...t),r.delete(n)}}return f}export{E as floodFill};
