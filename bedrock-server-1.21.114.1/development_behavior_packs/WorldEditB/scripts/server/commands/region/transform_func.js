import{assertCuboidSelection as u}from"server/modules/assert.js";import{Pattern as R}from"server/modules/pattern.js";import{Vector as y}from"library/Minecraft.js";import{set as k}from"./set.js";import{Jobs as g}from"server/modules/jobs.js";function*E(e,l,m,t){u(e);const o=e.history,n=o.record();let i;try{const[r,a]=e.selection.getRange(),s=l.dimension,p=y.from(r).add(a.add(1)).mul(.5),c=m.has("o")?p:y.from(l.location).floor().add(.5);t={offset:r.sub(c),...t},t.mask=t.mask?.withContext(e),yield g.nextStep("Gettings blocks..."),i=yield*e.createRegion(r,a);const[d,f]=i.getBounds(c,t);yield*o.trackRegion(n,r,a),yield*o.trackRegion(n,d,f),yield*k(e,new R("air"),null,!1),yield g.nextStep("Transforming blocks..."),yield*i.load(c,s,t),m.has("s")&&(o.trackSelection(n),e.selection.set(0,d),e.selection.set(1,f)),yield*o.commit(n)}catch(r){throw o.cancel(n),r}finally{e.deleteRegion(i)}}export{E as transformSelection};
