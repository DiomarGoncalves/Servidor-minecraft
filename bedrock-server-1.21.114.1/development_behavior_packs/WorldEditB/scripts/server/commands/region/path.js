import{assertClipboard as C,assertSelection as I}from"server/modules/assert.js";import{RawText as R,Vector as l}from"library/Minecraft.js";import{registerCommand as x}from"../register_commands.js";import{Jobs as A}from"server/modules/jobs.js";import{plotCurve as M}from"./paths_func.js";const P={name:"path",permission:"worldedit.region.path",description:"commands.wedit:path.description",usage:[{name:"spacing",type:"int",default:1,range:[1,null]},{subName:"rotated",args:[{name:"offset",type:"int"}]},{subName:"_"}]};x(P,function*(o,g,a){if(C(o),I(o),o.selection.mode!="convex")throw"commands.wedit:curve.invalidType";if(a.get("_using_item")&&o.globalPattern.empty())throw"worldEdit.selectionFill.noPattern";const u=a.get("spacing"),c=o.clipboard,h=c.getSize().mul(.5).floor().mul(-1),y=o.selection.points,b=g.dimension;let s=0;return yield*A.run(o,1,function*(){const e=o.history,m=e.record();try{const i=[],n=Array.from(M(y));for(let t=0;t<n.length;t++){if(t%u!==0)continue;const r=n[t],p=r.floor(),d={offset:h};if(a.has("rotated")){const f=(t<n.length-5?l.sub(n[Math.min(t+5,n.length-1)],r):l.sub(r,n[Math.max(t-5,0)])).normalized().toAngles();d.rotation=new l(360*f.x/(Math.PI*2),360*f.y/(Math.PI*2)+a.get("offset"),0)}const[w,v]=c.getBounds(p,d);yield*e.trackRegion(m,w,v),i.push([p,d])}for(const[t,r]of i)yield*c.load(t,b,r),yield s++/i.length;e.trackSelection(m),yield*e.commit(m)}catch(i){throw e.cancel(m),i}}),R.translate("commands.blocks.wedit:changed").with(`${s*c.getVolume()}`)});
