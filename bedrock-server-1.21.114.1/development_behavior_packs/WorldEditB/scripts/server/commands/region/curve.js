import{assertSelection as w}from"server/modules/assert.js";import{RawText as b,regionBounds as v}from"library/Minecraft.js";import{registerCommand as P}from"../register_commands.js";import{Jobs as a}from"server/modules/jobs.js";import{balloonPath as B,plotCurve as C}from"./paths_func.js";import x from"config.js";const R={name:"curve",permission:"worldedit.region.curve",description:"commands.wedit:curve.description",usage:[{name:"pattern",type:"Pattern"},{name:"thickness",type:"int",range:[0,x.maxBrushRadius],default:0}]};P(R,function*(t,l,n){if(w(t),t.selection.mode!="convex")throw"commands.wedit:curve.invalidType";if(n.get("_using_item")&&t.globalPattern.empty())throw"worldEdit.selectionFill.noPattern";const d=n.get("thickness"),s=t.selection.points,[p,f]=t.selection.getRange(),u=l.dimension,g=(n.get("_using_item")?t.globalPattern:n.get("pattern")).withContext(t,[p,f]),h=t.globalMask.withContext(t);let r;return yield*a.run(t,1,function*(){const e=t.history,i=e.record();try{const o=yield*B(C(s),d),[k,y]=v(o);yield*e.trackRegion(i,k,y),r=0;for(const c of o){const m=u.getBlock(c)??(yield*a.loadBlock(c));h.matchesBlock(m)&&g.setBlock(m)&&r++,yield r/o.size}e.trackSelection(i),yield*e.commit(i)}catch(o){throw e.cancel(i),o}}),b.translate("commands.blocks.wedit:changed").with(`${r}`)});
