import{assertClipboard as g}from"server/modules/assert";import{Jobs as l}from"server/modules/jobs.js";import{RawText as h,Vector as b}from"library/Minecraft.js";import{registerCommand as w}from"../register_commands.js";const y={name:"paste",permission:"worldedit.clipboard.paste",description:"commands.wedit:paste.description",usage:[{flag:"o"},{flag:"s"},{flag:"n"},{flag:"m",name:"mask",type:"Mask"}]};w(y,function*(t,r,o){g(t);const p=o.has("s")||o.has("n"),f=o.has("o"),m=!o.has("n");let i=b.from(r.location).floor().add(.5),n=t.clipboardTransform;if(f){if(t.clipboardTransform.originalDim!=r.dimension.id||!t.clipboardTransform.originalLoc)throw"commands.wedit:paste.noOriginal";i=t.clipboardTransform.originalLoc,n={}}const[c,d]=t.clipboard.getBounds(i,n),a=t.history,e=a.record();return yield*l.run(t,1,function*(){try{m&&(yield*a.trackRegion(e,c,d),yield l.nextStep("Pasting blocks..."),yield*t.clipboard.load(i,r.dimension,{...n,mask:o.get("m-mask")?.withContext(t)})),p&&(a.trackSelection(e),t.selection.mode=t.selection.mode=="extend"?"extend":"cuboid",t.selection.set(0,c),t.selection.set(1,d)),yield*a.commit(e)}catch(s){throw a.cancel(e),s}}),m?h.translate("commands.wedit:paste.explain").with(`${t.clipboard.getVolume()}`):""});
