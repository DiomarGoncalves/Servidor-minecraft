import{Tool as b}from"./base_tool.js";import{Tools as g}from"./tool_manager.js";import{Pattern as P}from"server/modules/pattern.js";import{Jobs as n}from"server/modules/jobs.js";import{regionBounds as k}from"library/Minecraft.js";import{floodFill as w}from"server/commands/utilities/floodfill_func.js";import{Cardinal as u}from"server/modules/directions.js";class D extends b{constructor(t,i,l,d=new u(u.Dir.DOWN)){super();this.onSurface=!0;this.permission="worldedit.utility.fillr";this.pattern=t,this.radius=i,this.depth=l,this.direction=d}*useOn(t,i,l){const d=t.dimension,p=this.direction.getDirection(t),m=this.radius,h=this.depth;let c=this.pattern;yield*n.run(i,1,function*(){yield n.nextStep("Calculating and Generating blocks..."),yield n.setProgress(-1);const r=yield*w(l,m,(e,o)=>!(p.dot(o)<0||p.dot(e.pos.add(o))>h-1||!e.nextBlock.isAir));if(!r.size)return r;const[f,y]=k(r);c=c.withContext(i,[f,y]);const s=i.history,a=s.record();try{yield*s.trackRegion(a,r);let e=0;for(const o of r)c.setBlock(d.getBlock(o)??(yield*n.loadBlock(o))),yield n.setProgress(e++/r.size);yield*s.commit(a)}catch(e){throw s.cancel(a),e}return r})}toJSON(){return{toolType:this.type,pattern:this.pattern,radius:this.radius,depth:this.depth,direction:this.direction.getDirectionLetter()}}static parseJSON(t){return[new P(t.pattern),t.radius,t.depth,new u(t.direction)]}}g.register(D,"fill_wand");
