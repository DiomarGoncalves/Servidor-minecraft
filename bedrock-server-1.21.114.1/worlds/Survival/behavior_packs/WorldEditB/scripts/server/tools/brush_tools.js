import{Tool as c}from"./base_tool.js";import{Tools as m}from"./tool_manager.js";import{brushTypes as b}from"../brushes/base_brush.js";import{Mask as u}from"server/modules/mask.js";import{PlayerUtil as h}from"server/modules/player_util.js";import{everyCall as p,Vector as o}from"library/Minecraft.js";const e=new WeakMap;class k extends c{constructor(t,r,s){super();this.range=null;this.mask=null;this.traceMask=null;this.permission="worldedit.brush";this.brush=t,this.mask=r,this.traceMask=s}*use(t,r){const s=h.traceForBlock(t,this.range,this.traceMask);if(!s)throw"commands.wedit:jumpto.none";yield*this.brush.apply(s,r,this.mask)}*tick(t,r){if(!r.drawOutlines)return;const s=h.traceForBlock(t,this.range,this.traceMask);if(!s)return;e.has(r)||e.set(r,{lastHit:s,lazyCall:p(4)});const[a,i]=this.brush.getOutline(),{lastHit:l,lazyCall:n}=e.get(r);l&&!l.equals(s)?a.draw(t,o.add(s,i)):n(()=>a.draw(t,o.add(s,i))),e.get(r).lastHit=s,yield}set size(t){this.brush.resize(t)}set material(t){this.brush.paintWith(t)}delete(){super.delete(),this.brush.delete()}toJSON(){if(this.brush.id!=="structure_brush")return{toolType:this.type,brush:this.brush,mask:this.mask,traceMask:this.traceMask}}static parseJSON(t){const r=b.get(t.brush.id);return[new r(...r.parseJSON(t.brush)),t.mask?new u(t.mask):null,t.traceMask?new u(t.traceMask):null]}}m.register(k,"brush");
