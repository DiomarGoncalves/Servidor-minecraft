import{Cardinal as h}from"server/modules/directions.js";import{Vector as O,regionBounds as k,regionOffset as B}from"library/Minecraft.js";import{Tool as T}from"./base_tool.js";import{Tools as w}from"./tool_manager.js";import{RegionBuffer as b}from"server/modules/region_buffer.js";import{floodFill as D}from"server/commands/utilities/floodfill_func.js";import{Jobs as F}from"server/modules/jobs.js";class P extends T{constructor(i,d){super();this.digging=!1;this.permission="worldedit.region.extruder";this.range=i,this.digging=d}*useOn(i,d,y){const l=i.dimension,n=new h(h.Dir.BACK).getDirection(i),p=O.from(n),x=l.getBlock(y).type;yield*F.run(d,1,function*(){const r=yield*D(y,this.range,(o,g)=>n.dot(g)===0&&o.nextBlock.type===x&&S(o.nextBlock.offset(p)));if(!r.size)return;let[e,t]=k(r);const a=d.history,m=a.record();let c;try{if(this.digging){let o=0;const g=r.size;for(const f of r)if(yield r.add(f.add(p)),++o>=g)break;[e,t]=k(r),c=yield*b.createFromWorld(e,t,l,{recordBlocksWithData:!0,modifier:f=>r.has(f)&&!f.offset(n.mul(-1)).matches("air")}),[e,t]=B(e,t,n.mul(-1))}else c=yield*b.createFromWorld(e,t,l,{recordBlocksWithData:!0,modifier:o=>r.has(o)}),[e,t]=B(e,t,n);yield*a.trackRegion(m,e,t),yield*c.load(e,l),yield*a.commit(m)}catch(o){throw a.cancel(m),o}finally{c?.deref()}}.bind(this))}toJSON(){return{toolType:this.type,range:this.range,digging:this.digging}}static parseJSON(i){return[i.range,i.digging]}}w.register(P,"extruder_wand");function S(u){const s=u.typeId;return s==="minecraft:air"||s==="minecraft:water"||s==="minecraft:lava"}
