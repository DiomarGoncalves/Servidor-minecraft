import{Cardinal as k}from"server/modules/directions.js";import{Mask as f}from"server/modules/mask.js";import{regionIterateBlocks as g}from"library/Minecraft.js";import{Tool as p}from"./base_tool.js";import{Tools as y}from"./tool_manager.js";import{RegionBuffer as h}from"server/modules/region_buffer.js";class u extends p{constructor(r,o){super();this.permission="worldedit.region.stack";this.range=r,this.mask=o}*useOn(r,o,i){const s=r.dimension,n=new k(k.Dir.BACK).getDirection(r),m=i.add(n),d=this.mask.withContext(o);if(!d.matchesBlock(s.getBlock(m)))return;let t=i;for(let e=0;e<this.range&&(t=t.add(n),!!d.matchesBlock(s.getBlock(t.add(n))));e++);const a=o.history,c=a.record();let l;try{yield*a.trackRegion(c,m,t),l=yield*h.createFromWorld(i,i,s);for(const e of g(m,t))yield*l.load(e,s);yield*a.commit(c)}catch(e){throw a.cancel(c),e}finally{l?.deref()}}toJSON(){return{toolType:this.type,range:this.range,mask:this.mask}}static parseJSON(r){return[r.range,new f(r.mask)]}}y.register(u,"stacker_wand");
