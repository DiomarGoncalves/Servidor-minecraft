import{assertCanBuildWithin as w,assertSelection as x}from"server/modules/assert.js";import{BiomeChanges as I}from"server/modules/biome_data.js";import{Jobs as l}from"server/modules/jobs.js";import{PlayerUtil as P}from"server/modules/player_util.js";import{RawText as S,regionIterateBlocks as R,Vector as a}from"library/Minecraft.js";import{registerCommand as z}from"../register_commands.js";const M={name:"setbiome",permission:"worldedit.biome.set",description:"commands.wedit:setbiome.description",usage:[{name:"biome",type:"Biome"},{flag:"p"}]},y=[];z(M,function*(e,t,g){let n=0;const c=g.get("biome").getId(),o=new I(t.dimension);if(g.has("p"))o.setBiome(P.getBlockLocation(t),c),o.flush(),n++,yield;else{x(e),w(t,...e.selection.getRange());let p=0;const b=e.selection.getBlockCount();yield*l.run(e,1,function*(){if(yield l.nextStep("Setting biome data..."),e.selection.isCuboid){const[i,h]=e.selection.getRange(),d=a.from(i).mul(1/16).floor(),u=a.from(h).mul(1/16).floor();for(let m=d.z;m<=u.z;m++)for(let s=d.y;s<=u.y;s++)for(let r=d.x;r<=u.x;r++){const B=new a(r,s,m).mul(16).max(i),C=new a(r,s,m).mul(16).add(15).min(h);for(const k of R(B.floor(),C.floor()))o.setBiome(k,c),yield l.setProgress(++p/b),n++;o.flush(),yield}}else{for(const i of e.selection.getBlocks())o.setBiome(i,c),yield l.setProgress(++p/b),n++;o.flush(),yield}})}let f=S.translate("commands.wedit:setbiome.changed").with(n);return y.includes(t)||(f=f.append("text",`
`).append("translate","commands.wedit:setbiome.warning"),y.push(t)),f});
