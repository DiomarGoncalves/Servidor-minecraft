import{Jobs as c}from"server/modules/jobs.js";import{RawText as p,Vector as t}from"library/Minecraft.js";import{registerCommand as k}from"../register_commands.js";import{floodFill as h}from"./floodfill_func.js";import{canPlaceBlock as b}from"server/util.js";const B={name:"drain",permission:"worldedit.utility.drain",description:"commands.wedit:drain.description",usage:[{name:"radius",type:"float"}]},I=[new t(0,0,0),new t(-1,0,0),new t(1,0,0),new t(0,0,-1),new t(0,0,1),new t(0,-1,0),new t(-1,-1,0),new t(1,-1,0),new t(0,-1,-1),new t(0,-1,1)];k(B,function*(a,g,w){const s=g.dimension,y=a.getPlacementPosition();let i,l;for(const e of I){const o=y.offset(e.x,e.y,e.z);if(!b(o,s))continue;const n=s.getBlock(o);if(n.typeId.match("water")||n.isWaterlogged)i="water";else if(n.typeId.match("lava"))i="lava";else continue;l=o;break}const m=i==="water";if(!l)throw"commands.wedit:drain.noFluid";const u=yield*c.run(a,1,function*(){yield c.nextStep("Calculating and Draining blocks..."),yield c.setProgress(-1);const e=yield*h(l,w.get("radius"),r=>r.nextBlock.typeId.match(i)?!0:m&&r.nextBlock.isWaterlogged);if(!e.size)return e;const o=a.history,n=o.record();try{yield*o.trackRegion(n,e);let r=0;for(const f of e){const d=s.getBlock(f)??(yield*c.loadBlock(f));m&&!d.typeId.match(i)?d.setWaterlogged(!1):d.setType("air"),yield c.setProgress(r++/e.size)}yield*o.commit(n)}catch(r){throw o.cancel(n),r}return e});return p.translate("commands.blocks.wedit:changed").with(`${u.size}`)});export{I as fluidLookPositions};
