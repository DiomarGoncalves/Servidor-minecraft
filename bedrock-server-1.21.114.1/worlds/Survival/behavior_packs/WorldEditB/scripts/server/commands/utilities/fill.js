import{Cardinal as f}from"server/modules/directions.js";import{Jobs as n}from"server/modules/jobs.js";import{RawText as h,regionBounds as k}from"library/Minecraft.js";import{registerCommand as D}from"../register_commands.js";import{floodFill as x}from"./floodfill_func.js";const P={name:"fill",permission:"worldedit.utility.fill",description:"commands.wedit:fill.description",usage:[{name:"pattern",type:"Pattern"},{name:"radius",type:"float"},{name:"depth",type:"int",range:[1,null],default:1},{name:"direction",type:"Direction",default:new f(f.Dir.DOWN)}]};D(P,function*(i,c,r){const m=c.dimension,s=r.get("direction").getDirection(c),u=r.get("depth"),p=i.getPlacementPosition(),y=yield*n.run(i,1,function*(){yield n.nextStep("Calculating and Generating blocks..."),yield n.setProgress(-1);const e=yield*x(p,r.get("radius"),(t,o)=>{const d=s.dot(o);return d<0||d==0&&t.fillDown||s.dot(t.pos.add(o))>u-1||!t.nextBlock.isAir?!1:(d>0&&(t.fillDown=!0),!0)});if(!e.size)return e;const[g,w]=k(e),C=r.get("pattern").withContext(i,[g,w]),l=i.history,a=l.record();try{yield*l.trackRegion(a,e);let t=0;for(const o of e)C.setBlock(m.getBlock(o)??(yield*n.loadBlock(o))),yield n.setProgress(t++/e.size);yield*l.commit(a)}catch(t){throw l.cancel(a),t}return e});return h.translate("commands.blocks.wedit:changed").with(`${y.size}`)});
