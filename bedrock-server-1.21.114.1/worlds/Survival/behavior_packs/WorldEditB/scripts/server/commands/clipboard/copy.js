import{assertCuboidSelection as p}from"server/modules/assert.js";import{Jobs as s}from"server/modules/jobs.js";import{RawText as g,Vector as r}from"library/Minecraft.js";import{BlockPermutation as h}from"@minecraft/server";import{registerCommand as C}from"../register_commands.js";const R={name:"copy",permission:"worldedit.clipboard.copy",description:"commands.wedit:copy.description",usage:[{flag:"a"},{flag:"e"},{flag:"m",name:"mask",type:"Mask"}]};function*x(o,e,i){p(o);const m=o.player,[n,b]=o.selection.getRange(),a=e.get("_using_item"),y=a?o.includeEntities:e.has("e"),c=a?o.includeAir:!e.has("a"),t=(a?o.globalMask.clone():e.get("m-mask"))?.withContext(o),k=h.resolve("minecraft:air"),w=t||!c;yield s.nextStep("Copying blocks...");const B=f=>{const d=f.isAir,u=d||(t?!t.matchesBlock(f):!1);return c&&t&&!d&&u?k:!(!c&&u)},l=yield*o.createRegion(n,b,{includeEntities:y,modifier:w?B:void 0});if(l)return i&&(o.clipboard=l,o.clipboardTransform={rotation:r.ZERO,scale:r.ONE,originalLoc:n,originalDim:m.dimension.id,offset:r.sub(n,r.from(m.location).floor().add(.5))}),l}C(R,function*(o,e,i){if(p(o),!(yield*s.run(o,1,x(o,i,!0))))throw g.translate("commands.generic.wedit:commandFail");return g.translate("commands.wedit:copy.explain").with(`${o.clipboard.getVolume()}`)});export{x as copy};
