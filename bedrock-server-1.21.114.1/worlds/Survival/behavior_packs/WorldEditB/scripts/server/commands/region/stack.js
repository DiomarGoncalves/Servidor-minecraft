import{assertCuboidSelection as x}from"server/modules/assert.js";import{Cardinal as R}from"server/modules/directions.js";import{Jobs as u}from"server/modules/jobs.js";import{RawText as z,regionBounds as S,regionSize as V,regionVolume as C}from"library/Minecraft.js";import{registerCommand as B}from"../register_commands.js";import{copy as I}from"../clipboard/copy.js";const b={name:"stack",permission:"worldedit.region.stack",description:"commands.wedit:stack.description",usage:[{flag:"a"},{flag:"e"},{flag:"r"},{flag:"s"},{name:"count",type:"int",range:[1,null],default:1},{name:"offset",type:"Direction",default:new R},{flag:"m",name:"mask",type:"Mask"}]};B(b,function*(e,m,i){x(e);const y=i.get("count"),[s,d]=e.selection.getRange(),h=m.dimension,k=V(s,d),t=i.get("offset").getDirection(m).mul(i.has("r")?1:k);let a=s.offset(t.x,t.y,t.z),l=d.offset(t.x,t.y,t.z),g=0;const o=[],p=[];for(let n=0;n<y;n++)o.push([a,l]),p.push(a,l),a=a.offset(t.x,t.y,t.z),l=l.offset(t.x,t.y,t.z);const w=S(p),r=e.history,f=r.record();return yield*u.run(e,o.length+1,function*(){let n;try{n=yield*I(e,i,!1),yield*r.trackRegion(f,...w);for(const c of o)yield u.nextStep("Pasting blocks..."),yield*n.load(c[0],h),g+=C(c[0],c[1]);i.has("s")&&(r.trackSelection(f),e.selection.set(0,o[o.length-1][0]),e.selection.set(1,o[o.length-1][1])),yield*r.commit(f)}catch(c){throw r.cancel(f),c}finally{e.deleteRegion(n)}}),z.translate("commands.wedit:stack.explain").with(g)});
