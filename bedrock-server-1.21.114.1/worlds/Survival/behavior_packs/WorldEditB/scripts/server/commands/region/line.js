import{assertCuboidSelection as b}from"server/modules/assert.js";import{RawText as w,Vector as p}from"library/Minecraft.js";import{registerCommand as y}from"../register_commands.js";import{Jobs as g}from"server/modules/jobs.js";import{balloonPath as P,plotLine as C}from"./paths_func.js";import V from"config.js";const B={name:"line",permission:"worldedit.region.line",description:"commands.wedit:line.description",usage:[{name:"pattern",type:"Pattern"},{flag:"t",name:"thickness",type:"int",range:[0,V.maxBrushRadius]}]};y(B,function*(t,h,i){if(b(t),t.selection.mode!="cuboid")throw"commands.wedit:line.invalidType";if(i.get("_using_item")&&t.globalPattern.empty())throw"worldEdit.selectionFill.noPattern";const m=i.get("t-thickness")??0;let l,d,o,e;t.selection.mode=="cuboid"&&([l,d]=t.selection.points,[o,e]=t.selection.getRange(),[o,e]=[o.sub(m),e.add(m)]);const s=h.dimension,u=(i.get("_using_item")?t.globalPattern:i.get("pattern")).withContext(t,[o,e]),k=t.globalMask.withContext(t);let a;return yield*g.run(t,1,function*(){const n=t.history,r=n.record();try{yield*n.trackRegion(r,o,e),a=0;for(const c of P(C(p.from(l),p.from(d)),m)){const f=s.getBlock(c)??(yield*g.loadBlock(c));k.matchesBlock(f)&&u.setBlock(f)&&a++,yield}n.trackSelection(r),yield*n.commit(r)}catch(c){throw n.cancel(r),c}}),w.translate("commands.blocks.wedit:changed").with(`${a}`)});
