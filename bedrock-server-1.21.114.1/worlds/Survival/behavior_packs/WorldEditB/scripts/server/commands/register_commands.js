import{Server as h,Thread as P,Timer as R,RawText as p,contentLog as m}from"library/Minecraft.js";import{getSession as i,hasSession as F}from"../sessions.js";import{print as x,printerr as T}from"../util.js";import{UnloadedChunksError as S}from"server/modules/assert.js";const a=new Map,C=[];function W(e,s){a.set(e.name,[e,s]),h.command.register(e,(r,$,d)=>{if(!F(r.id))return;const c=i(r).usingItem;d.set("_using_item",i(r).usingItem);const g=new P;return g.start(function*(u,n,f){const w=new R;try{w.start(),m.log(`Processing command '${u}' for '${n.name}'`);let t;s.constructor.name=="GeneratorFunction"?t=yield*s(i(n),n,f):t=s(i(n),n,f);const o=w.end();m.log(`Time taken to execute: ${o}ms (${o/1e3} secs)`),t&&x(t,n,c)}catch(t){const o=t.message?p.text(`${t.name}: `).append("translate",t.message):t;m.error(`Command '${u}' failed for '${n.name}' with msg: ${o}`),T(o,n,c),t instanceof S?C.includes(n)||(C.push(n),x("commands.generic.wedit:outsideWorld.detail",n,!1)):t.stack&&T(t.stack,n,!1)}},$,r,d),g})}function _(e){return a.get(e)[1]}function A(e){return a.get(e)[0]}export{_ as getCommandFunc,A as getCommandInfo,W as registerCommand};
