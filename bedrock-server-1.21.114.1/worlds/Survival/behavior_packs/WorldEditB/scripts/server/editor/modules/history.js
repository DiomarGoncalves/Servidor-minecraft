import{History as o,setHistoryClass as i}from"server/modules/history";import{EditorModule as s}from"./base";import{getCurrentThread as c}from"library/Minecraft.js";const t=new WeakMap;class d extends o{record(){return this.transactionManager.openTransaction("WorldEdit operation")||this.assertNotRecording(),this.activeThread=c(),0}*commit(){yield,this.transactionManager.commitOpenTransaction(),this.activeThread=void 0}cancel(){this.transactionManager.commitOpenTransaction(),this.activeThread=void 0}*trackRegion(e,r,n){yield,"x"in r?this.transactionManager.trackBlockChangeArea(r,n):this.transactionManager.trackBlockChangeList(Array.from(r))}trackSelection(){console.error("Selection tracking is not implemented yet.")}*undo(){return yield,this.transactionManager.undoSize()?(this.transactionManager.undo(),!1):!0}*redo(){return yield,this.transactionManager.redoSize()?(this.transactionManager.redo(),!1):!0}clear(){console.error("History clear is not implemented.")}isRecording(){const e=this.transactionManager.openTransaction("Testing WorldEdit history recording");return e&&this.transactionManager.discardOpenTransaction(),!e}getActivePointsInThread(e){return e===this.activeThread?[0]:[]}get transactionManager(){return t.get(this.player)}}i(d);class k extends s{constructor(e){super(e),t.set(this.player,this.session.extensionContext.transactionManager)}teardown(){t.delete(this.player)}}export{k as HistoryModule};
